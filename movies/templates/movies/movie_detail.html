{% extends "_layouts/base.html" %}
{% load url from future %}
{% load comments %}
{% load ratings_tags %}

{% block extra_jquery %}
<link href="{{ STATIC_URL }}/star-rating/jquery.rating.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="{{ STATIC_URL }}star-rating/jquery.MetaData.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}star-rating/jquery.rating.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}star-rating/application.js"></script>
{% endblock %}

{% block page_title %} {{ movie.title }} | {% endblock %}
{% block page_header %} Details{% endblock %}
{% block message %}
<h3> <a href="{{ movie.get_absolute_url }}">{{ movie.title }}</a></h3>
{% endblock %}
{% block content %}
<img class="thumbnail" data-src="holder.js/360x270" src="{{ MEDIA_URL }}{{ movie.photo }}">
<p>{{ movie.description|linebreaks }}</p>
<hr>
Starting from : <h3>{{ movie.start_date }}</h3>
Ending on : <h3>{{ movie.end_date}}</h3>
<hr>
<div class="row-fluid">
  <div class="span12">
{% get_comment_count for movie as comment_count %}
<h3>This movie has {{ comment_count }} reviews.</h3>
{% render_comment_list for movie %}
{% if user.is_authenticated %}
{% get_comment_form for object as form %}
<div class="span5 offset1">
<form action="{% comment_form_target %}" method="POST">
  {% csrf_token %}
  <p>Your Experience ( in one word ):</p> {{ form.experience }}
  <p>Review : </p>{{ form.comment }}
  {{ form.content_type }}
  {{ form.object_pk }}
  {{ form.timestamp }}
  {{ form.security_hash }}
  <input type="hidden" name="next" value="{{ movie.get_absolute_url }}" />
  <button type="submit" class="btn btn-primary"><i class="icon-comment"></i> Submit</button>
</form>
</div>
<div class="span4">
  {% get_rating_form for movie as rating_form %}
  <form action="{% url ratings_vote %}" method="post">
    {% csrf_token %}
    <p>Vote here :</p>{{ rating_form }}
    <button type="submit" class="btn btn-primary"><i class="icon-star"></i> Vote</button>
  </form>
  {% get_rating_score for movie as score %}
  {% if score %}
    <h3>Average score: {{ score.average|floatformat }}</h3>
    <h3> Number of votes: {{ score.num_votes }}</h3>
      {% else %}
    <p>How sad: nobody voted for</p>
    <p>{{ movie }}</p>
  {% endif %}
</div>
</div>
</div>
{% else %}
<p>Please <a href="/accounts/login/">log in</a> to share your experience after watching -  {{ movie.title }}.</p>
{% endif %}
{% endblock %}
